"use strict";(self.webpackChunkez_theme=self.webpackChunkez_theme||[]).push([[9662],{16034(t,e,a){var r=a(46518),l=a(32357).values;r({target:"Object",stat:!0},{values:function(t){return l(t)}})},32124(t,e,a){a.d(e,{fU:()=>l,oL:()=>r});a(51629),a(59089),a(18111),a(7588),a(79432),a(26099),a(23500),a(76031);function r(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object.keys(t).forEach(function(e){t[e]&&(t[e]._repeat?clearInterval(t[e]):clearTimeout(t[e]),t[e]=null)}),Object.keys(e).forEach(function(t){var a=e[t];a&&a.element&&a.event&&a.callback&&(a.element.removeEventListener(a.event,a.callback,a.options),e[t]=null)})}function l(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300,a=null;return function(){for(var r=arguments.length,l=new Array(r),o=0;o<r;o++)l[o]=arguments[o];var n=this;return a&&clearTimeout(a),a=setTimeout(function(){t.apply(n,l),a=null},e)}}},32357(t,e,a){var r=a(43724),l=a(79039),o=a(79504),n=a(42787),i=a(71072),c=a(25397),s=o(a(48773).f),u=o([].push),f=r&&l(function(){var t=Object.create(null);return t[2]=2,!s(t,2)}),d=function(t){return function(e){for(var a,l=c(e),o=i(l),d=f&&null===n(l),v=o.length,g=0,p=[];v>g;)a=o[g++],r&&!(d?a in l:s(l,a))||u(p,t?[a,l[a]]:l[a]);return p}};t.exports={entries:d(!0),values:d(!1)}},89662(t,e,a){a.r(e),a.d(e,{default:()=>j});var r=a(20908),l=a(59258),o=a(30388),n=(a(28706),a(2008),a(51629),a(74423),a(62062),a(44114),a(94490),a(34782),a(26910),a(23288),a(62010),a(18111),a(22489),a(7588),a(61701),a(9868),a(26099),a(16034),a(78459),a(31415),a(17642),a(58004),a(33853),a(45876),a(32475),a(15024),a(31698),a(21699),a(47764),a(42762),a(23500),a(62953),a(76031),a(20641)),i=a(90033),c=a(50953),s=a(46992),u=a(14860),f=a(19043);function d(){return(0,f.A)({url:"/user/stat/getTrafficLog",method:"get"})}var v=a(49586),g=a(80394),p=a(92545),y=a(32124),m={class:"trafficlog-container"},L={class:"trafficlog-inner"},h={class:"dashboard-card welcome-card"},k={class:"card-header"},S={class:"card-title"},b={class:"card-body"},C={class:"formula-card"},T={class:"formula-title"},F={class:"formula-content"},D={class:"dashboard-card chart-card"},E={class:"card-header"},w={class:"card-title"},_={key:0,class:"chart-toggle-buttons"},R={class:""},x={class:""},$={class:"card-body"},O={key:0,class:"loading-container"},A={key:1,class:"error-container"},G={key:2,class:"empty-container"},z={key:0,class:"dashboard-card"},I={class:"card-header"},X={class:"card-title"},V={class:"card-body"},P={key:0,class:"loading-container"},Y={key:1,class:"error-container"},M={key:2,class:"empty-container"},N={key:3,class:"traffic-table-container"},B={class:"traffic-table"};const K={__name:"TrafficLog",setup:function(t){var e=(0,s.s9)().t,a=(0,c.KR)([]),f=(0,c.KR)(!0),K=(0,c.KR)(!1),j=(0,c.KR)(null),U=null,q=(0,c.KR)(!1),Q=function(){var t=(0,o.A)((0,r.A)().m(function t(){var e,o,n;return(0,r.A)().w(function(t){for(;;)switch(t.p=t.n){case 0:return f.value=!0,K.value=!1,t.p=1,t.n=2,d();case 2:(e=t.v)&&e.data?(a.value=e.data.sort(function(t,e){return e.record_at-t.record_at}),g.TRAFFICLOG_CONFIG.daysToShow>0&&(o=(0,l.A)(new Set(a.value.map(function(t){var e=new Date(1e3*t.record_at);return"".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate())})))).length>g.TRAFFICLOG_CONFIG.daysToShow&&(n=o.slice(0,g.TRAFFICLOG_CONFIG.daysToShow),a.value=a.value.filter(function(t){var e=new Date(1e3*t.record_at),a="".concat(e.getFullYear(),"-").concat(e.getMonth()+1,"-").concat(e.getDate());return n.includes(a)}))):a.value=[],t.n=4;break;case 3:t.p=3,t.v,K.value=!0;case 4:return t.p=4,f.value=!1,t.f(4);case 5:return t.a(2)}},t,null,[[1,3,4,5]])}));return function(){return t.apply(this,arguments)}}(),H=function(t){q.value=t,J()},J=function(){if(U&&U.dispose(),j.value&&0!==a.value.length){U=p.Ts(j.value);var t,r=getComputedStyle(document.documentElement).getPropertyValue("--theme-color").trim()||"#355cc2",o=[],n=[],i=[],c=[];if(g.TRAFFICLOG_CONFIG.sumDailyTraffic){var s={};a.value.forEach(function(t){var e=t.record_at;s[e]||(s[e]={record_at:e,u:0,d:0}),q.value?(s[e].u+=t.u,s[e].d+=t.d):(s[e].u+=t.u*parseFloat(t.server_rate),s[e].d+=t.d*parseFloat(t.server_rate))}),t=Object.values(s).slice(0,30)}else t=(0,l.A)(a.value).slice(0,30).reverse();t.forEach(function(t){o.push((0,v.Yq)(t.record_at));var e=parseFloat((t.u/1073741824).toFixed(2)),a=parseFloat((t.d/1073741824).toFixed(2));n.push(e),i.push(a),c.push(parseFloat((e+a).toFixed(2)))});var u={tooltip:{trigger:"axis",formatter:function(t){var e=t[0].name+"<br/>";return t.forEach(function(t){var a=t.value+" GB";e+=t.marker+" "+t.seriesName+": "+a+"<br/>"}),e}},legend:{data:[e("trafficLog.uploadTraffic"),e("trafficLog.downloadTraffic"),e("trafficLog.totalTraffic")],bottom:0,textStyle:{color:getComputedStyle(document.documentElement).getPropertyValue("--text-color").trim()||"#333333"}},grid:{left:"3%",right:"4%",bottom:"60px",top:"30px",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:o,axisLabel:{rotate:45,interval:"auto",color:getComputedStyle(document.documentElement).getPropertyValue("--text-color").trim()||"#333333"},axisLine:{lineStyle:{color:getComputedStyle(document.documentElement).getPropertyValue("--border-color").trim()||"#e8e8e8"}},splitLine:{lineStyle:{color:getComputedStyle(document.documentElement).getPropertyValue("--border-color").trim()||"#e8e8e8"}}},yAxis:{type:"value",name:"GB",nameTextStyle:{padding:[0,0,0,10],color:getComputedStyle(document.documentElement).getPropertyValue("--text-color").trim()||"#333333"},axisLabel:{formatter:"{value} GB",color:getComputedStyle(document.documentElement).getPropertyValue("--text-color").trim()||"#333333"},axisLine:{lineStyle:{color:getComputedStyle(document.documentElement).getPropertyValue("--border-color").trim()||"#e8e8e8"}},splitLine:{lineStyle:{color:getComputedStyle(document.documentElement).getPropertyValue("--border-color").trim()||"#e8e8e8"}}},series:[{name:e("trafficLog.uploadTraffic"),type:"line",stack:"Total",smooth:!0,lineStyle:{width:2},showSymbol:!1,areaStyle:{opacity:.2},emphasis:{focus:"series"},data:n,color:"#36AD47"},{name:e("trafficLog.downloadTraffic"),type:"line",stack:"Total",smooth:!0,lineStyle:{width:2},showSymbol:!1,areaStyle:{opacity:.2},emphasis:{focus:"series"},data:i,color:"#4080FF"},{name:e("trafficLog.totalTraffic"),type:"line",smooth:!0,lineStyle:{width:3},showSymbol:!1,emphasis:{focus:"series"},data:c,color:r}]};U.setOption(u),window.addEventListener("resize",W)}},W=function(){U&&U.resize()},Z=(0,y.fU)(W,200);(0,n.wB)(a,function(){!f.value&&!K.value&&a.value.length>0&&(0,n.dY)(function(){J()})},{deep:!0});var tt=null,et=!0;return(0,n.sV)(function(){Q(),function(){tt&&tt.disconnect();var t=null;(tt=new MutationObserver(function(){et||(clearTimeout(t),t=setTimeout(function(){(0,n.dY)(function(){U&&j.value&&J()})},300))})).observe(document.documentElement,{attributes:!0,attributeFilter:["class","style"]}),setTimeout(function(){et=!1},800)}(),window.addEventListener("resize",Z)}),(0,n.hi)(function(){U&&(U.dispose(),U=null),window.removeEventListener("resize",Z),tt&&(tt.disconnect(),tt=null)}),function(t,e){return(0,n.uX)(),(0,n.CE)("div",m,[(0,n.Lk)("div",L,[(0,n.Lk)("div",h,[(0,n.Lk)("div",k,[(0,n.Lk)("h2",S,(0,i.toDisplayString)(t.$t("trafficLog.title")),1)]),(0,n.Lk)("div",b,[(0,n.Lk)("p",null,(0,i.toDisplayString)(t.$t("trafficLog.description")),1),(0,n.Lk)("div",C,[(0,n.Lk)("div",T,(0,i.toDisplayString)(t.$t("trafficLog.formula"))+":",1),(0,n.Lk)("div",F,(0,i.toDisplayString)(t.$t("trafficLog.formulaContent")),1)])])]),(0,n.Lk)("div",D,[(0,n.Lk)("div",E,[(0,n.Lk)("h2",w,(0,i.toDisplayString)(t.$t("trafficLog.trafficChart")),1),(0,c.R1)(g.TRAFFICLOG_CONFIG).sumDailyTraffic?((0,n.uX)(),(0,n.CE)("div",_,[(0,n.Lk)("button",{onClick:e[0]||(e[0]=function(t){return H(!1)}),class:(0,i.normalizeClass)({active:!q.value})},[(0,n.Lk)("span",R,(0,i.toDisplayString)(t.$t("trafficLog.deductedTraffic")),1)],2),(0,n.Lk)("button",{onClick:e[1]||(e[1]=function(t){return H(!0)}),class:(0,i.normalizeClass)({active:q.value})},[(0,n.Lk)("span",x,(0,i.toDisplayString)(t.$t("trafficLog.actualTraffic")),1)],2)])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",$,[f.value?((0,n.uX)(),(0,n.CE)("div",O,[e[2]||(e[2]=(0,n.Lk)("div",{class:"loading-spinner"},null,-1)),(0,n.Lk)("p",null,(0,i.toDisplayString)(t.$t("trafficLog.loadingTraffic")),1)])):K.value?((0,n.uX)(),(0,n.CE)("div",A,[(0,n.bF)((0,c.R1)(u.GBC),{size:48,class:"error-icon"}),(0,n.Lk)("p",null,(0,i.toDisplayString)(t.$t("trafficLog.errorLoadingTraffic")),1)])):a.value.length?((0,n.uX)(),(0,n.CE)("div",{key:3,ref_key:"chartRef",ref:j,class:"traffic-chart"},null,512)):((0,n.uX)(),(0,n.CE)("div",G,[(0,n.bF)((0,c.R1)(u.vUY),{size:48,class:"empty-icon"}),(0,n.Lk)("p",null,(0,i.toDisplayString)(t.$t("trafficLog.noTrafficData")),1)]))])]),(0,c.R1)(g.TRAFFICLOG_CONFIG).showTrafficTable?((0,n.uX)(),(0,n.CE)("div",z,[(0,n.Lk)("div",I,[(0,n.Lk)("h2",X,(0,i.toDisplayString)(t.$t("trafficLog.title")),1)]),(0,n.Lk)("div",V,[f.value?((0,n.uX)(),(0,n.CE)("div",P,[e[3]||(e[3]=(0,n.Lk)("div",{class:"loading-spinner"},null,-1)),(0,n.Lk)("p",null,(0,i.toDisplayString)(t.$t("trafficLog.loadingTraffic")),1)])):K.value?((0,n.uX)(),(0,n.CE)("div",Y,[(0,n.bF)((0,c.R1)(u.GBC),{size:48,class:"error-icon"}),(0,n.Lk)("p",null,(0,i.toDisplayString)(t.$t("trafficLog.errorLoadingTraffic")),1),(0,n.Lk)("button",{class:"retry-button",onClick:Q},(0,i.toDisplayString)(t.$t("trafficLog.retry")),1)])):a.value.length?((0,n.uX)(),(0,n.CE)("div",N,[(0,n.Lk)("table",B,[(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,(0,i.toDisplayString)(t.$t("trafficLog.date")),1),(0,n.Lk)("th",null,(0,i.toDisplayString)(t.$t("trafficLog.uploadTraffic")),1),(0,n.Lk)("th",null,(0,i.toDisplayString)(t.$t("trafficLog.downloadTraffic")),1),(0,n.Lk)("th",null,(0,i.toDisplayString)(t.$t("trafficLog.totalTraffic")),1),(0,n.Lk)("th",null,(0,i.toDisplayString)(t.$t("trafficLog.serverRate")),1),(0,n.Lk)("th",null,(0,i.toDisplayString)(t.$t("trafficLog.deductedTraffic")),1)])]),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.value,function(t,e){return(0,n.uX)(),(0,n.CE)("tr",{key:e},[(0,n.Lk)("td",null,(0,i.toDisplayString)((0,c.R1)(v.Yq)(t.record_at)),1),(0,n.Lk)("td",null,(0,i.toDisplayString)((0,c.R1)(v.zM)(t.u)),1),(0,n.Lk)("td",null,(0,i.toDisplayString)((0,c.R1)(v.zM)(t.d)),1),(0,n.Lk)("td",null,(0,i.toDisplayString)((0,c.R1)(v.zM)(t.u+t.d)),1),(0,n.Lk)("td",null,(0,i.toDisplayString)(t.server_rate)+"x",1),(0,n.Lk)("td",null,(0,i.toDisplayString)((0,c.R1)(v.zM)((t.u+t.d)*parseFloat(t.server_rate))),1)])}),128))])])])):((0,n.uX)(),(0,n.CE)("div",M,[(0,n.bF)((0,c.R1)(u.vUY),{size:48,class:"empty-icon"}),(0,n.Lk)("p",null,(0,i.toDisplayString)(t.$t("trafficLog.noTrafficData")),1)]))])])):(0,n.Q3)("",!0)])])}}};const j=(0,a(66262).A)(K,[["__scopeId","data-v-2467d494"]])},94490(t,e,a){var r=a(46518),l=a(79504),o=a(34376),n=l([].reverse),i=[1,2];r({target:"Array",proto:!0,forced:String(i)===String(i.reverse())},{reverse:function(){return o(this)&&(this.length=this.length),n(this)}})}}]);